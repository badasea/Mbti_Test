# ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„
name: Deploy Next.js to GitHub Pages by Branch

# ì–¸ì œ ì´ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•  ê²ƒì¸ì§€ ì •ì˜
on:
  push:
    branches:
      - main # main ë¸Œëœì¹˜ì— push
      - develop # develop ë¸Œëœì¹˜ì— push
  workflow_dispatch:

# ì‘ì—…ì— í•„ìš”í•œ ê¶Œí•œ ì„¤ì •
permissions:
  contents: read
  pages: write
  id-token: write

# ìˆ˜í–‰í•  ì‘ì—…(Job) ì •ì˜
jobs:
  # ë¹Œë“œ ì‘ì—…
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4 # 1. ë¦¬í¬ì§€í† ë¦¬ ì½”ë“œë¥¼ ê°€ìƒ í™˜ê²½ìœ¼ë¡œ ë¶ˆëŸ¬ì˜´

      - name: Setup Node.js âš™ï¸
        uses: actions/setup-node@v4 # 2. Node.js í™˜ê²½ ì„¤ì •
        with:
          node-version: "18"
          cache: "npm"

      - name: Install dependencies ğŸ“¦
        run: npm install # 3. ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜

      - name: Build project ğŸ”¨
        # â­ í•µì‹¬: ë¸Œëœì¹˜ì— ë”°ë¼ ë¹Œë“œ ëª…ë ¹ì–´ë¥¼ ë‹¤ë¥´ê²Œ ì‹¤í–‰!
        # main ë¸Œëœì¹˜ë©´ npm run build ì‹¤í–‰
        env:
          NEXT_PUBLIC_BASE_PATH: ${{ github.ref_name == 'main' && '/Mbti_Test' || '/Mbti_Test/dev' }}
        run: npm run build

      - name: Upload artifact â¬†ï¸
        uses: actions/upload-pages-artifact@v3 # 5. ë¹Œë“œ ê²°ê³¼ë¬¼ì„ GitHub Pagesì— ë°°í¬í•  ìˆ˜ ìˆë„ë¡ ì—…ë¡œë“œ
        with:
          # â­ í•µì‹¬: ë¸Œëœì¹˜ì— ë”°ë¼ ê²°ê³¼ë¬¼ì„ ë‹¤ë¥¸ ê²½ë¡œì— ì €ì¥
          path: ./out

  # ë°°í¬ ì‘ì—…
  deploy:
    # build ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ëë‚˜ì•¼ ì‹¤í–‰ë¨
    needs: build
    runs-on: ubuntu-latest
    environment:
      # â­ í•µì‹¬: ë¸Œëœì¹˜ì— ë”°ë¼ ë°°í¬ë  URLì„ ë‹¤ë¥´ê²Œ ì„¤ì •
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}${{ github.ref_name == 'develop' && 'dev' || '' }}
    steps:
      - name: Deploy to GitHub Pages ğŸš€
        id: deployment
        uses: actions/deploy-pages@v4 # 6. ì—…ë¡œë“œëœ ê²°ê³¼ë¬¼ì„ GitHub Pagesì— ë°°í¬
